<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Matter.js Ball Pool Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="./assets/style.css">
  <!-- Styles moved to assets/style.css -->
</head>
<script>
  (function (d) {
    var config = {
        kitId: 'cgc8yqp',
        scriptTimeout: 3000,
        async: true
      },
      h = d.documentElement,
      t = setTimeout(function () {
        h.className = h.className.replace(/\bwf-loading\b/g, "") + " wf-inactive";
      }, config.scriptTimeout),
      tk = d.createElement("script"),
      f = false,
      s = d.getElementsByTagName("script")[0],
      a;
    h.className += " wf-loading";
    tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
    tk.async = true;
    tk.onload = tk.onreadystatechange = function () {
      a = this.readyState;
      if (f || a && a != "complete" && a != "loaded") return;
      f = true;
      clearTimeout(t);
      try {
        Typekit.load(config)
      } catch (e) {}
    };
    s.parentNode.insertBefore(tk, s)
  })(document);
</script>

<body>
  <div id="menu-bar"><span id="menu-about">About</span></div>
  <div id="restart-overlay">Restart</div>
  <div id="press-overlay">Press</div>
  <div id="keep-press-overlay" style="display:none;">Keep Press</div>
  <div id="center-text">2024-12-03,22:27</div>
  <div class="clip-bg" id="clip-bg">
    <div class="clip-text" id="clip-text">
    </div>
  </div>
  <div id="article-list" class="article-list"></div>
  <!-- Matter.js 라이브러리 로드 -->
  <script src="../build/matter.js"></script>
  <script src="./assets/canvas.js"></script>
  <script src="./assets/clipmask.js"></script>
  <script src="./assets/datePhysics.js"></script>
  <script src="./assets/articleLoader.js"></script>
  <script>
    // Press overlay fade out on first interaction
    var pressOverlay = document.getElementById('press-overlay');
    var keepPressOverlay = document.getElementById('keep-press-overlay');
    var keepPressTimeout = null;
    var pressHidden = false;

    function scheduleKeepPress() {
      if (!keepPressOverlay || !pressHidden) return;
      clearTimeout(keepPressTimeout);
      keepPressTimeout = setTimeout(function () {
        keepPressOverlay.style.display = 'block';
        if (pressOverlay) pressOverlay.style.display = 'none';
      }, 2000);
    }

    function hideKeepPress() {
      if (!keepPressOverlay || !pressHidden) return;
      clearTimeout(keepPressTimeout);
      keepPressOverlay.style.display = 'none';
    }

    if (pressOverlay) {
      var hidePressOverlay = function () {
        pressOverlay.classList.add('fade-out');
        if (window.fadeInDate) window.fadeInDate();
        setTimeout(function () {
          pressOverlay.style.display = 'none';
          pressHidden = true;
        }, 200);
        document.body.removeEventListener('mousedown', hidePressOverlay);
        scheduleKeepPress();
      };
      document.body.addEventListener('mousedown', hidePressOverlay);
    }
    // 날짜와 클리핑 마스크 인터랙션 + 기사 변경
    var pressIntervalId = null;
    document.body.addEventListener('mousedown', function (e) {
      if (e.target.closest('#article-list')) return; // ignore clicks in sidebar
      if (window.startClipShake) window.startClipShake();
      if (window.addOneDay) window.addOneDay();
      if (window.nextArticle) window.nextArticle();
      if (pressIntervalId) return;
      pressIntervalId = setInterval(function () {
        if (window.addOneDay) window.addOneDay();
        if (window.nextArticle) window.nextArticle();
      }, 500);

      hideKeepPress();
    });
    document.body.addEventListener('mouseup', function (e) {
      if (e.target.closest('#article-list')) return;
      if (window.stopClipShake) window.stopClipShake();
      clearInterval(pressIntervalId);
      pressIntervalId = null;

      scheduleKeepPress();
    });
    document.body.addEventListener('mouseleave', function (e) {
      if (e.target.closest('#article-list')) return;
      if (window.stopClipShake) window.stopClipShake();
      clearInterval(pressIntervalId);
      pressIntervalId = null;

      scheduleKeepPress();
    });

    // ------------------ Inactivity Restart ------------------
    (function () {
      var restartOverlay = document.getElementById('restart-overlay');

      function showRestart() {
        restartOverlay.style.display = 'block';
      }

      function resetTimer() {
        restartOverlay.style.display = 'none';
        clearTimeout(window.__idleTimer);
        window.__idleTimer = setTimeout(showRestart, 30 * 60 * 1000);
      }
      ['mousemove', 'mousedown', 'keydown', 'touchstart'].forEach(function (ev) {
        document.addEventListener(ev, resetTimer, {
          passive: true
        });
      });
      resetTimer();
      restartOverlay.addEventListener('click', function () {
        location.reload();
      });
    })();

    // ------------------ About Window ------------------
    (function () {
      var aboutBtn = document.getElementById('menu-about');
      if (!aboutBtn) return;
      aboutBtn.addEventListener('click', function () {
        if (document.getElementById('about-window')) return;
        var aw = document.createElement('div');
        aw.id = 'about-window';
        aw.className = 'about-window';
        aw.innerHTML =
          `<div class="window-bar"><span class="win-btn red"></span><span class="win-btn yellow"></span><span class="win-btn green"></span></div><div class="about-content"><h2>About</h2><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p><p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p></div>`;
        document.body.appendChild(aw);
        aw.querySelector('.win-btn.red').addEventListener('click', function (e) {
          e.stopPropagation();
          aw.remove();
        });
        aw.querySelector('.win-btn.yellow').addEventListener('click', function (e) {
          e.stopPropagation();
          aw.style.display = 'none';
        });
        aw.querySelector('.win-btn.green').addEventListener('click', function (e) {
          e.stopPropagation();
          aw.style.display = 'block';
        });
      });
    })();
    // ----------------------------------------------------
  </script>
</body>

</html>